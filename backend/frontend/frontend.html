<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Legal Simplifier</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f7fb;
      color: #222;
      padding: 30px;
      max-width: 900px;
      margin: auto;
    }
    h1 { color: #1e3a8a; }
    textarea, input[type="file"] {
      width: 100%;
      margin-top: 10px;
      margin-bottom: 20px;
    }
    button {
      background: #2563eb;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover { background: #1e40af; }
    .section {
      background: white;
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    pre {
      background: #f9fafb;
      padding: 10px;
      border-radius: 5px;
      white-space: pre-wrap;
    }
    #train-section {
      background: #fffbe6;
      border: 1px solid #facc15;
      display: none;
    }
    .toggle-btn {
      background: #facc15;
      color: #222;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    .toggle-btn:hover { background: #eab308; }
    .output-actions {
      margin-top: 15px;
    }
    .output-actions button {
      margin-right: 10px;
      background: #4b5563;
    }
    .output-actions button:hover {
      background: #111827;
    }
  </style>
</head>
<body>

  <h1>‚öñÔ∏è AI Legal Simplifier</h1>
  <p>Summarize, Simplify, and Analyze Indian Legal Texts</p>

  <!-- Upload Legal Document -->
  <div class="section">
    <h3>üìÑ Upload Legal Document</h3>
    <input type="file" id="fileInput">
    <button onclick="processFile()">Process File</button>
  </div>

  <!-- Type Text -->
  <div class="section">
    <h3>‚úçÔ∏è Enter Legal Text</h3>
    <textarea id="textInput" rows="6" placeholder="Type or paste your legal text here..."></textarea>
    <button onclick="processText()">Simplify & Summarize</button>
  </div>

  <!-- Output -->
  <div class="section">
    <h3>üßæ Results</h3>
    <pre id="output">Your results will appear here...</pre>

    <div class="output-actions">
      <button onclick="copyOutput()">üìã Copy Result</button>
      <button onclick="downloadOutput()">üíæ Download as .txt</button>
    </div>
  </div>

  <!-- Developer Fine-Tuning -->
  <button class="toggle-btn" onclick="toggleFineTune()">üîê Developer Mode: Fine-tune Model</button>

  <div id="train-section" class="section">
    <h3>üß† Fine-tune Model</h3>
    <p>Upload a JSON dataset to fine-tune your summarizer model.</p>
    <input type="file" id="trainFile">
    <button onclick="trainModel()">Fine-tune Model</button>
    <pre id="trainOutput"></pre>
  </div>

  <script>
    const API_URL = "http://127.0.0.1:8000";
    let latestOutput = "";

    function toggleFineTune() {
      const section = document.getElementById("train-section");
      section.style.display = section.style.display === "none" ? "block" : "none";
    }

    async function processFile() {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("Please choose a file first.");

      const formData = new FormData();
      formData.append("file", file);

      const res = await fetch(`${API_URL}/process`, { method: "POST", body: formData });
      const data = await res.json();
      displayFormattedOutput(data);
    }

    async function processText() {
      const text = document.getElementById("textInput").value;
      if (!text.trim()) return alert("Please enter some text.");

      const res = await fetch(`${API_URL}/process-text`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text }),
      });
      const data = await res.json();
      displayFormattedOutput(data);
    }

    // üßæ Format Output Nicely
    function displayFormattedOutput(data) {
      let result = "";

      if (data.error) {
        result = `‚ö†Ô∏è Error: ${data.error}`;
      } else {
        result += `üìò Summary:\n${data.summary || "No summary available."}\n\n`;
        result += `ü™∂ Simplified:\n${data.simplified || "No simplified text."}\n\n`;

        if (data.articles_found?.length) {
          result += `‚öñÔ∏è Laws Found:\n`;
          for (const ref of data.articles_found) {
            const details = data.law_details?.[ref];
            if (details) {
              result += `‚Ä¢ ${ref} ‚Äî ${details.description}`;
              if (details.match_type && details.match_type !== "exact") {
                result += ` (${details.match_type})`;
              }
              result += `\n`;
            }
          }
        }
      }

      latestOutput = result;
      document.getElementById("output").textContent = result;
    }

    // üìã Copy to Clipboard
    function copyOutput() {
      if (!latestOutput) return alert("No output to copy.");
      navigator.clipboard.writeText(latestOutput)
        .then(() => alert("Copied to clipboard!"))
        .catch(err => alert("Failed to copy: " + err));
    }

    // üíæ Download Output
    function downloadOutput() {
      if (!latestOutput) return alert("No output to download.");
      const blob = new Blob([latestOutput], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "legal_summary.txt";
      link.click();
      URL.revokeObjectURL(link.href);
    }

    // üß† Fine-tune model
    async function trainModel() {
      const file = document.getElementById("trainFile").files[0];
      if (!file) return alert("Please select a JSON dataset.");
      const formData = new FormData();
      formData.append("file", file);
      document.getElementById("trainOutput").textContent = "‚è≥ Fine-tuning in progress... Please wait.";
      const res = await fetch(`${API_URL}/train-json`, { method: "POST", body: formData });
      const data = await res.json();
      document.getElementById("trainOutput").textContent = JSON.stringify(data, null, 2);
    }
  </script>

</body>
</html>
